2장 느려진 서비스, 어디부터 봐야할까

1. 처리량과 응답시간
- 응답시간
  - 응답시간은 API요청 전송 시간, 서버의 처리 시간, API 응답 전송 시간으로 나뉜다.
  - 서버의 처리시간
    - 로직 수행(if, for)
    - DB 연동
    - 외부 API 연동
    - 응답 데이터 생성
  - 이 중 DB 연동과 외부 API 연동이 전체 서버 처리시간중 9할 이상을 차지한다.
 
- 처리량
  - 최대 TPS는 시스템이 처리할 수 있는 최대 요청 수
 
2. 서버 성능 개선 기초
- 병목지점
  - 최대 TPS를 초과하는 트래픽이 유입되기 때문에 발생. 주로 DB나 외부API 연동 과정에서 발생
- 수직확장과 수평 확장
  - 수직확장
    - 더 빠른 CPU로 바꾸거나 CPU 코어수를 늘리고 메모리를 확장하는 방법
  - 수평확장
    - 서버를 추가로 도입
  - 로드밸런서
    - 정적방식
       - 라운드로빈
         - 클라이언트의 요청을 각 서버에 순차적으로 분배
       - IP해시
          - IP주소를 해시한 값을 기반으로 동일 클라이언트는 항상 같은 서버로 연결
    - 동적방식
        - 서버의 현재 상태에 따라 트래픽이 적은 서버에 요청을 보냄
- DB 커넥션 풀
   - DB에 연결된 커넥션을 미리 생성해서 보관함 (DB와 연결하는 네트워크 통신 시간을 줄이기 위해)
   - 커넥션 풀 크기, 커넥션 대기 시간을 적절히 설정해야함
   - 최대 유휴시간, 최대 유지 시간
     - 커넥션의 사용여부에 따라 DB와의 네트워크 연결 차단에 대한 설정값
- 서버 캐시
   - 로컬 캐시
     - 서버 프로세스와 동일한 메모리에 캐시 저장소 사용
       - 데이터에 빠르게 접근할 수 있지만 메모리영역이기 때문에 저장 데이터 크기에 제한이 있음
   - 리모트 캐시
     - Redis
       - 데이터 규모도 크고, 서버 프로세스가 재시작되더라도 레디스에 저장된 캐시 데이터는 그대로지만 네트워크 통신을 해야하므로 속도 이슈
- 메모리 사용
  - 파일 다운로드 기능 구현시
    - 파일을 한 번에 메모리에 로딩하는 코드 지양
    - 스트림을 활용해 파일을 끊어서 읽는 코드 적용해야함 스트림 ??
- 응답 데이터 압축
  - 응답 시간에는 네트워크속도, 전송 데이터 크기 2가지 요인에 영향을 받음
  - HTML, CSS, JS, JSON같이 텍스트로 구성된 응답은 압축하면 70%이상 데이터 전송량을 줄일 수 있음
  - Accept-Encoding 요청 헤더와 Content-Encoding 응답 헤더를 통해 사용가능한 압축 알고리즘 송수신
- CDN(콘텐츠 전송 네트워크)
  - 이미지, JS 같은 정적 자원을 빠르게 로드하기 위해서 오리진 서버 앞단에 캐시 형태로 존재
       
