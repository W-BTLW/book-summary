# 외부 연동이 문제일 때 살펴봐야 할 것들

## 증가하는 외부 연동 서비스
제공하는 서비스가 다양할수록 연동되는 외부 서비스도 많아짐
외부 연동서비스의 문제를 완전히 차단하기는 어렵지만, 최대한 영향도를 줄이도록 설계해야함

## 타임아웃
외부 연동에서 가장 중요한 설정 중 하나
- 연결 타임아웃 : 외부 서비스로의 네트워크 연결 시도 단계. (TCP 연결이 성립될때까지의 최대 시간)
- 읽기 타임아웃 : 외부 서비스에 연결된 후 응답을 받기까지의 단 (TCP 연결후 HTTP 응답이 올때까지의 최대시간)

## 재시도
- 단순조회기능, 연결 타임아웃 : 서비스 운영에 영향을 끼치지 않으므로 부담없이 재시도 가능
- 읽기 타임아웃 : 이미 연동된 서비스가 요청을 처리하고 있으므로 멱등성을 고려하여 조심해서 처리
   - 멱등성이란? 여러번 API 요청을 날려도(같은 연산을 한 번 수행하든, 여러 번 반복 수행하든) 시스템의 최종 상태와 결과가 동일하게 유지되는 성질
- 횟수와 간격 : 무한정 재시도는 불가능, 외부 연동 서비스의 부하도 고려하여 설정

## 동시 요청 제한
- 외부 연동 서비스의 처리 요청 한도를 고려하여 특정 서비스에 동시 요청을 제한하는 방식 ex) 벌크헤드 설계 패턴

## 서킷 브레이커
- 연동 서비스가 장애 상황인 경우 연동 시도도 하지않고 (연결 타임아웃도 기다릴 필요 없음) 곧바로 차단하는 방식

## 외부 연동과 DB 연동
- 외부 연동에 실패했을때 트랜잭션(DB) 롤백
  - 읽기 타임아웃에서 실패가 떨어지는 경우는 실제로 외부서비스가 성공했을 가능성이 존재함 FDS...?
- 외부 연동에 성공했는데, DB연동 실패인 경우
  - 연동 서비스에 취소API와 같은 이전 상태로 되돌리는 작업 필요
 
## HTTP 커넥션 풀
- HTTP 커넥션 풀의 크기
- 풀에서 HTTP 커넥션을 가져올 때까지 대기하는 시간
- HTTP 커넥션을 유지할 시간

## 연동 서비스 이중화
- 대안이 없는 서비스의 경우는 해당 서비스에서 서버 이중화 잘 해놔야할텐데.. 행안부 왜 안했누
